#!/bin/bash

WD=`pwd`
PKG='PACKAGES.txt'
VIM='vim/'
TMUX='tmux/'
CONFIGS='configs/'
GITCONFIG=$CONFIGS'gitconfig'
ALIAS=$CONFIGS'bash_aliases'

## Functions

clean() {
    echo "Reverting changes"

    if [[ -d "~/.vim" ]]; then
        rm -rf ~/.vim
        rm ~/.vimrc
    fi

    if [[ -d "~/.tmux" ]]; then
        rm -rf ~/.tmux
        rm ~/.tmux.conf
    fi

    if [[ -f "~/.gitconfig" ]]; then
        rm ~/.gitconfig
    fi

    if [[ -f "~/.bash_aliases" ]]; then
        rm ~/.bash_aliases
    fi
}


setup_vim() {
    cd $WD
    cd vim
    bash install.sh install
}

setup_tmux() {
    cd $WD
    cp -av $TMUX ~/.tmux
    cd ~/.tmux
    echo "Choose OS :"
    echo -e "\t1. Ubuntu 14.04 - Ubuntu 16.04\n\t2. Ubuntu 18.04\n\t3. MacOS"
    read version

    case "$version" in
        1)
            bash install.sh 1404
            ;;
        2)
            bash install.sh 1604
            ;;
        3)
            bash install.sh mac
            ;;
        *)
            echo "Invalid option chosen"
            cleanup
            exit 1
    esac
}

setup_git_config() {
    flag=1
    cd $WD
    cp $GITCONFIG ~/.gitconfig
}

setup_bash_aliases() {
    cd $WD
    cp $ALIAS ~/.bash_aliases
    source ~/.bashrc
}

setup_packages() {
    cd $WD
    sudo apt-get update
    while read -r line; do
        pkg="$line"
        sudo apt-get install $pkg -y
    done < "$PKG"
}

setup_softwares() {
    sudo dpkg -i ./softwares/google-chrome-stable_current_amd64.deb
}

main() {
    clean
    if [[ $EUID -eq 0 ]]; then
        setup_packages
    fi
    setup_bash_aliases
    setup_git_config
    setup_tmux
    setup_vim
    cd $WD
}

main
